{% extends 'base.html' %}
{% block title %}–ò—Å—Ç–æ—Ä–∏—è —Ä–∞—Å—Å—ã–ª–æ–∫{% endblock %}
{% block content %}

<div class="container mt-4">
  <div class="d-flex justify-content-between align-items-center mb-3">
    <h2>–ò—Å—Ç–æ—Ä–∏—è —Ä–∞—Å—Å—ã–ª–æ–∫</h2>
  </div>

  <!-- üîπ –§–∏–ª—å—Ç—Ä –ø–æ —Ä–∞—Å—Å—ã–ª–∫–µ -->
  <form method="get" class="mb-4">
    <div class="row g-2 align-items-center">
      <div class="col-auto">
        <label for="mailing" class="form-label mb-0">–§–∏–ª—å—Ç—Ä –ø–æ —Ä–∞—Å—Å—ã–ª–∫–µ:</label>
      </div>
      <div class="col-auto">
        <select name="mailing" id="mailing" class="form-select" onchange="this.form.submit()">
          <option value="">–í—Å–µ —Ä–∞—Å—Å—ã–ª–∫–∏</option>
          {% for mailing in mailings %}
            <option value="{{ mailing.id }}" {% if selected_mailing == mailing.id|stringformat:"s" %}selected{% endif %}>
              {{ mailing.name }}
            </option>
          {% endfor %}
        </select>
      </div>
    </div>
  </form>

  {% if logs %}
    <table class="table table-striped align-middle">
      <thead class="table-primary">
        <tr>
          <th>–î–∞—Ç–∞ –∏ –≤—Ä–µ–º—è</th>
          <th>–†–∞—Å—Å—ã–ª–∫–∞</th>
          <th>–ü–æ–ª—É—á–∞—Ç–µ–ª—å</th>
          <th>–°—Ç–∞—Ç—É—Å</th>
          <th>–û—Ç–≤–µ—Ç —Å–µ—Ä–≤–µ—Ä–∞</th>
        </tr>
      </thead>
      <tbody>
        {% for log in logs %}
          <tr>
            <td>{{ log.timestamp|date:"d.m.Y H:i:s" }}</td>
            <td>{{ log.mailing.name }}</td>
            <td>{{ log.recipient.email }}</td>
            <td>
              {% if log.status == 'success' %}
                <span class="badge bg-success">–£—Å–ø–µ—à–Ω–æ</span>
              {% else %}
                <span class="badge bg-danger">–û—à–∏–±–∫–∞</span>
              {% endif %}
            </td>
            <td class="small text-muted">{{ log.server_response|default:"‚Äî" }}</td>
          </tr>
        {% endfor %}
      </tbody>
    </table>

    <!-- –ü–∞–≥–∏–Ω–∞—Ü–∏—è -->
    {% if is_paginated %}
      <nav aria-label="pagination">
        <ul class="pagination justify-content-center">
          {% if page_obj.has_previous %}
            <li class="page-item">
              <a class="page-link" href="?page={{ page_obj.previous_page_number }}{% if selected_mailing %}&mailing={{ selected_mailing }}{% endif %}">–ù–∞–∑–∞–¥</a>
            </li>
          {% endif %}
          <li class="page-item disabled">
            <span class="page-link">–°—Ç—Ä. {{ page_obj.number }} –∏–∑ {{ page_obj.paginator.num_pages }}</span>
          </li>
          {% if page_obj.has_next %}
            <li class="page-item">
              <a class="page-link" href="?page={{ page_obj.next_page_number }}{% if selected_mailing %}&mailing={{ selected_mailing }}{% endif %}">–í–ø–µ—Ä—ë–¥</a>
            </li>
          {% endif %}
        </ul>
      </nav>
    {% endif %}
  {% else %}
    <div class="alert alert-info">–ü–æ–∫–∞ –Ω–µ—Ç –∑–∞–ø–∏—Å–µ–π –≤ –∏—Å—Ç–æ—Ä–∏–∏ —Ä–∞—Å—Å—ã–ª–æ–∫.</div>
  {% endif %}
</div>

{% endblock %}
